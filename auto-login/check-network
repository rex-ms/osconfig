#!/bin/bash

export DISPLAY=:0
export PATH=/home/loongson/sangmeng/auto-login:$PATH

target_host="sysdev.loongson.cn"

echo "AutoCheck: begin"
date

ping -c 1 -w 3 "$target_host" > /dev/null 2>&1
ping_result=$?

echo "AutoCheck: end"

#if [ $ping_result -ne 0 ]; then
  echo "AutoLogin triggered"
  date
  autologin >> ./al.log  2>&1
  login_status=$?

  if [ $login_status -eq 0 ]; then
    echo "autologin finished successfully"
  else
    echo "autologin failed"
  fi

  # Verify network connectivity again
  ping -c 1 -w 3 "$target_host" > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    echo "Network is back online"
  else
    echo "Network is still unreachable"
  fi
#fi
